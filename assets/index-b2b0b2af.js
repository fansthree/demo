import{T as y,b as w,g as p,e as g,s as v}from"./index-cb89bee1.js";import{l as $}from"./logo-2bebb97f.js";import{t as f,h as b,A as m}from"./utils-b0fc676a.js";import{S as k}from"./time-8b7fa869.js";import{a as S,x as i,h as x,m as h,n as c,t as l,e as C}from"./vendor-dd3f77fa.js";const P="";var _=Object.defineProperty,j=Object.getOwnPropertyDescriptor,r=(t,e,a,o)=>{for(var n=o>1?void 0:o?j(e,a):e,u=t.length-1,d;u>=0;u--)(d=t[u])&&(n=(o?d(e,a,n):d(n))||n);return o&&n&&_(e,a,n),n};let s=class extends y(P){constructor(){super(...arguments),this.bindBridge=new S(this,w),this.creating=!1,this.linking=!0,this.supply=0,this.updateSupply=p("Fans3Shares").then(t=>t.sharesSupply(this.account).then(e=>(this.supply=e,e)).catch(()=>0)),this.holders=p("Fans3Shares").then(t=>t.getFansOfSubject(this.account).then(e=>i`<ul>${x(e,a=>i`<li>${a}(${h(f(a),i`<i class="text-sm mdi mdi-loading"></i>`)}): ${h(b(this.account,a),i`<i class="text-sm mdi mdi-loading"></i>`)}</li>`)}</ul>`))}get account(){return w.account}connectedCallback(){super.connectedCallback(),g.on("wallet-changed",async()=>{this.linking=!0,this.twitter="",await this.updateTwitter()})}updateTwitter(){return this.account?fetch(m+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1}):Promise}async link(){for(this.linking=!0;;){try{let t=await fetch(m+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await v(k)}}async create(){this.creating=!0;try{let t=await p("Fans3Shares"),e=await t.getBuyPriceAfterFee(this.account,1);await(await t.buyShares(this.account,1,{value:e})).wait(),this.updateSupply}catch(t){this.err=t}this.creating=!1}render(){return i`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${$}"></div><div class="ui-container">${c(this.err,()=>i`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn></div>${c(this.account&&!this.twitter,()=>(this.updateTwitter(),i`<div class="my-4">Link your twitter to continue<ui-button href="${m}/login?address=${this.account}" @click="${this.link}" class="ml-2 uppercase ${c(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${c(this.linking,()=>i`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))} ${c(this.account&&this.twitter,()=>i`<div class="my-4">Twitter: ${this.twitter.name}</div><ui-link link href="/x/${this.account}" class="my-2">Link to buy my share</ui-link><div class="my-4"><span class="my-2">${h(this.updateSupply,i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)} holdings</span><br>${c(this.supply,()=>i`${h(this.holders,i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`,()=>i`<ui-button sm class="my-2" ?disabled="${this.creating}" @click="${this.create}">Create${c(this.creating,()=>i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button>`)}</div>`)}</div></div>`}};r([l()],s.prototype,"twitter",2);r([l()],s.prototype,"creating",2);r([l()],s.prototype,"linking",2);r([l()],s.prototype,"err",2);r([l()],s.prototype,"supply",2);r([l()],s.prototype,"updateSupply",2);r([l()],s.prototype,"holders",2);s=r([C("view-home")],s);export{s as ViewHome};
