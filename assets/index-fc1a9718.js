import{T as g,b as h,g as o,e as b}from"./index-1767a6e6.js";import{l as S}from"./logo-637148f3.js";import{s as v,a as w}from"./utils-964c3991.js";import{a as $,j as y,x as s,h as f,m as c,n as u,t as a,e as x}from"./vendor-dd3f77fa.js";var P=Object.defineProperty,H=Object.getOwnPropertyDescriptor,r=(e,t,l,p)=>{for(var n=p>1?void 0:p?H(t,l):t,d=e.length-1,m;d>=0;d--)(m=e[d])&&(n=(p?m(t,l,n):m(n))||n);return p&&n&&P(t,l,n),n};let i=class extends g({}){constructor(){super(...arguments),this.bindBridge=new $(this,h),this.shareHolder="",this.buying=!1,this.selling=!1,this.price=o("Fans3Shares").then(e=>e.getBuyPrice(this.shareHolder,1).then(t=>y(t))),this.buyPrice=o("Fans3Shares").then(e=>e.getBuyPrice(this.shareHolder,1).then(t=>y(t))),this.sellPrice=o("Fans3Shares").then(e=>e.getSellPrice(this.shareHolder,1).then(t=>y(t))),this.holders=o("Fans3Shares").then(e=>e.getFansOfSubject(this.shareHolder).then(t=>s`<ul>${f(t,l=>s`<li>${l}: ${c(v(this.account,l))}</li>`)}</ul>`))}async reloadSupply(){console.debug("got account",h.account),h.account&&(console.debug("load supply"),this.numSupply=await w(h.account),this.requestUpdate())}connectedCallback(){super.connectedCallback(),this.account?this.reloadSupply():b.on("wallet-changed",this.reloadSupply.bind(this))}get account(){return h.account}async buy(){this.buying=!0;try{let e=await o("Fans3Shares"),t=await e.getBuyPriceAfterFee(this.shareHolder,1);await(await e.buyShares(this.shareHolder,1,{value:t})).wait()}catch(e){this.err=e}this.buying=!1}async sell(){this.selling=!0;try{await(await(await o("Fans3Shares")).sellShares(this.shareHolder,1)).wait()}catch(e){this.err=e}this.selling=!1}render(){return s`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${S}"></div><div class="ui-container">${u(this.err,()=>s`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn></div><p><span>You are viewing ${this.shareHolder}'s shares</span><br><span>Shares: ${c(this.numSupply,s`<i class="text-sm mdi mdi-loading"></i>`)}</span><br><span>Price: ${c(this.price,s`<i class="text-sm mdi mdi-loading"></i>`)}</span></p><div class="my-4 ${u(this.account,()=>"hidden")}">Connect your wallet to buy/sell shares</div><p>Buy price: ${c(this.buyPrice,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.buying}" @click="${this.buy}">Buy${u(this.buying,()=>s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button></p>${u(this.numSupply!=null,()=>s`<p>Sell price: ${c(this.sellPrice,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.selling}" @click="${this.sell}">Sell${u(this.selling,()=>s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button></p><p class="my-2">Holders:</p>${c(this.holders,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`)}</div></div>`}};r([a()],i.prototype,"shareHolder",2);r([a()],i.prototype,"buying",2);r([a()],i.prototype,"selling",2);r([a()],i.prototype,"err",2);r([a()],i.prototype,"numSupply",2);r([a()],i.prototype,"price",2);r([a()],i.prototype,"buyPrice",2);r([a()],i.prototype,"sellPrice",2);r([a()],i.prototype,"holders",2);i=r([x("tg-buy")],i);export{i as TGBuy};
