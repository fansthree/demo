import{T as b,b as w,g as c,s as $}from"./index-8c686621.js";import{t as m,h as v,A as y,l as f,S as x}from"./utils-3f67b1f0.js";import{a as S,j as g,x as s,h as H,m as l,n,t as a,e as P}from"./vendor-aedf1e0d.js";var F=Object.defineProperty,k=Object.getOwnPropertyDescriptor,r=(t,e,h,d)=>{for(var o=d>1?void 0:d?k(e,h):e,u=t.length-1,p;u>=0;u--)(p=t[u])&&(o=(d?p(e,h,o):p(o))||o);return d&&o&&F(e,h,o),o};let i=class extends b({}){constructor(){super(...arguments),this.bindBridge=new S(this,w),this.shareHolder="",this.buying=!1,this.selling=!1,this.linking=!0,this.supply=0,this.updateSupply=c("Fans3Shares").then(t=>t.sharesSupply(this.shareHolder).then(e=>(this.supply=e,e)).catch(()=>0)),this.price=c("Fans3Shares").then(t=>t.getBuyPrice(this.shareHolder,1).then(e=>g(e))),this.buyPrice=c("Fans3Shares").then(t=>t.getBuyPrice(this.shareHolder,1).then(e=>g(e))),this.sellPrice=c("Fans3Shares").then(t=>t.getSellPrice(this.shareHolder,1).then(e=>g(e))),this.holders=c("Fans3Shares").then(t=>t.getFansOfSubject(this.shareHolder).then(e=>s`<ul>${H(e,h=>s`<li>${h}(${l(m(h),s`<i class="text-sm mdi mdi-loading"></i>`)}): ${l(v(this.account,h))}</li>`)}</ul>`))}updateTwitter(){return fetch(y+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1})}get account(){return w.account}async link(){for(this.linking=!0;;){try{let t=await fetch(y+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await $(x)}}async buy(){this.buying=!0;try{let t=await c("Fans3Shares"),e=await t.getBuyPriceAfterFee(this.shareHolder,1);await(await t.buyShares(this.shareHolder,1,{value:e})).wait()}catch(t){this.err=t}this.buying=!1}async sell(){this.selling=!0;try{await(await(await c("Fans3Shares")).sellShares(this.shareHolder,1)).wait()}catch(t){this.err=t}this.selling=!1}render(){return s`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${f}"></div><div class="ui-container">${n(this.err,()=>s`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn>${n(this.twitter,()=>s`<br>Twitter: ${this.twitter.name}`)}</div><div class="my-4"><span>You are viewing ${this.shareHolder}(${l(m(this.shareHolder),s`<i class="text-sm mdi mdi-loading"></i>`)})'s shares</span><br><span>Holding: ${l(this.updateSupply,s`<i class="text-sm mdi mdi-loading"></i>`)}</span><br><span>Price: ${l(this.price,s`<i class="text-sm mdi mdi-loading"></i>`)}</span></div><div class="my-4 ${n(this.account,()=>"hidden")}">Connect your wallet to buy/sell shares</div>${n(this.account&&!this.twitter,()=>(this.updateTwitter(),s`<div class="my-4">Link your twitter to continue<ui-button href="${y}/login?address=${this.account}" @click="${this.link}" class="ml-2 ${n(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${n(this.linking,()=>s`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))}<div class="my-4">Buy price: ${l(this.buyPrice,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.buying}" @click="${this.buy}">Buy${n(this.buying,()=>s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button><br>Sell price: ${l(this.sellPrice,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.selling}" @click="${this.sell}">Sell${n(this.selling,()=>s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button></div><div class="my-4"><span class="my-2">Holdings: of ${this.shareHolder}(${l(m(this.shareHolder),s`<i class="text-sm mdi mdi-loading"></i>`)})</span><br>${n(this.supply,()=>s`${l(this.holders,s`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`)}</div></div></div>`}};r([a()],i.prototype,"twitter",2);r([a()],i.prototype,"shareHolder",2);r([a()],i.prototype,"buying",2);r([a()],i.prototype,"selling",2);r([a()],i.prototype,"linking",2);r([a()],i.prototype,"err",2);r([a()],i.prototype,"supply",2);r([a()],i.prototype,"updateSupply",2);r([a()],i.prototype,"price",2);r([a()],i.prototype,"buyPrice",2);r([a()],i.prototype,"sellPrice",2);r([a()],i.prototype,"holders",2);i=r([P("view-ex")],i);export{i as ViewEx};
