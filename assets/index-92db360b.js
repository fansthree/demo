import{T as w,b as g,g as p,s as $}from"./index-76ff09ab.js";import{t as v,h as b,A as m,C as y,l as f,S}from"./utils-01e1e8b4.js";import{a as x,x as e,h as k,m as h,n as r,t as l,e as C}from"./vendor-38c8194b.js";const _="";var O=Object.defineProperty,T=Object.getOwnPropertyDescriptor,n=(t,i,a,o)=>{for(var c=o>1?void 0:o?T(i,a):i,u=t.length-1,d;u>=0;u--)(d=t[u])&&(c=(o?d(i,a,c):d(c))||c);return o&&c&&O(i,a,c),c};let s=class extends w(_){constructor(){super(...arguments),this.bindBridge=new x(this,g),this.creating=!1,this.linking=!0,this.supply=0,this.updateSupply=p("Fans3Shares",{address:y}).then(t=>t.sharesSupply(this.account).then(i=>(this.supply=i,i)).catch(()=>0)),this.holders=p("Fans3Shares",{address:y}).then(t=>t.getFansOfSubject(this.account).then(i=>e`<ul>${k(i,a=>e`<li>${a}(${h(v(a),e`<i class="text-sm mdi mdi-loading"></i>`)}): ${h(b(this.account,a),e`<i class="text-sm mdi mdi-loading"></i>`)}</li>`)}</ul>`))}get account(){return g.account}updateTwitter(){return fetch(m+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1})}async link(){for(this.linking=!0;;){try{let t=await fetch(m+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await $(S)}}async create(){this.creating=!0;try{let t=await p("Fans3Shares",{address:y}),i=await t.getBuyPriceAfterFee(this.account,1);await(await t.buyShares(this.account,1,{value:i})).wait(),this.updateSupply}catch(t){this.err=t}this.creating=!1}render(){return e`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${f}"></div><div class="ui-container">${r(this.err,()=>e`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn></div>${r(this.account&&!this.twitter,()=>(this.updateTwitter(),e`<div class="my-4">Link your twitter to continue<ui-button href="${m}/login?address=${this.account}" @click="${this.link}" class="ml-2 ${r(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${r(this.linking,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))} ${r(this.twitter,()=>e`<div class="my-4">Twitter: ${this.twitter.name}</div>`)} ${r(this.account&&this.twitter,()=>e`<ui-button href="/x/${this.account}" class="my-2" sm>Link to buy my share</ui-button><div class="my-4"><span class="my-2">${h(this.updateSupply,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)} holdings</span><br>${r(this.supply,()=>e`${h(this.holders,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`,()=>e`<ui-button sm class="my-2" ?disabled="${this.creating}" @click="${this.create}">Create${r(this.creating,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button>`)}</div>`)}</div></div>`}};n([l()],s.prototype,"twitter",2);n([l()],s.prototype,"creating",2);n([l()],s.prototype,"linking",2);n([l()],s.prototype,"err",2);n([l()],s.prototype,"supply",2);n([l()],s.prototype,"updateSupply",2);n([l()],s.prototype,"holders",2);s=n([C("view-home")],s);export{s as ViewHome};
