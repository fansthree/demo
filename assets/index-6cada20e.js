import{T as y,b as w,g as p,e as g,s as v}from"./index-5416e41c.js";import{t as $,h as b,A as m,l as f,S as k}from"./utils-7ae0cd61.js";import{a as S,x as e,h as x,m as h,n as c,t as l,e as C}from"./vendor-aedf1e0d.js";const P="";var _=Object.defineProperty,j=Object.getOwnPropertyDescriptor,n=(t,i,a,o)=>{for(var r=o>1?void 0:o?j(i,a):i,u=t.length-1,d;u>=0;u--)(d=t[u])&&(r=(o?d(i,a,r):d(r))||r);return o&&r&&_(i,a,r),r};let s=class extends y(P){constructor(){super(...arguments),this.bindBridge=new S(this,w),this.creating=!1,this.linking=!0,this.supply=0,this.updateSupply=p("Fans3Shares").then(t=>t.sharesSupply(this.account).then(i=>(this.supply=i,i)).catch(()=>0)),this.holders=p("Fans3Shares").then(t=>t.getFansOfSubject(this.account).then(i=>e`<ul>${x(i,a=>e`<li>${a}(${h($(a),e`<i class="text-sm mdi mdi-loading"></i>`)}): ${h(b(this.account,a),e`<i class="text-sm mdi mdi-loading"></i>`)}</li>`)}</ul>`))}get account(){return w.account}connectedCallback(){super.connectedCallback(),g.on("wallet-changed",async()=>{this.linking=!0,this.twitter="",await this.updateTwitter()})}updateTwitter(){return this.account?fetch(m+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1}):Promise}async link(){for(this.linking=!0;;){try{let t=await fetch(m+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await v(k)}}async create(){this.creating=!0;try{let t=await p("Fans3Shares"),i=await t.getBuyPriceAfterFee(this.account,1);await(await t.buyShares(this.account,1,{value:i})).wait(),this.updateSupply}catch(t){this.err=t}this.creating=!1}render(){return e`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${f}"></div><div class="ui-container">${c(this.err,()=>e`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn></div>${c(this.account&&!this.twitter,()=>(this.updateTwitter(),e`<div class="my-4">Link your twitter to continue<ui-button href="${m}/login?address=${this.account}" @click="${this.link}" class="ml-2 uppercase ${c(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${c(this.linking,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))} ${c(this.account&&this.twitter,()=>e`<div class="my-4">Twitter: ${this.twitter.name}</div><ui-link link href="/x/${this.account}" class="my-2">Link to buy my share</ui-link><div class="my-4"><span class="my-2">${h(this.updateSupply,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)} holdings</span><br>${c(this.supply,()=>e`${h(this.holders,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`,()=>e`<ui-button sm class="my-2" ?disabled="${this.creating}" @click="${this.create}">Create${c(this.creating,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button>`)}</div>`)}</div></div>`}};n([l()],s.prototype,"twitter",2);n([l()],s.prototype,"creating",2);n([l()],s.prototype,"linking",2);n([l()],s.prototype,"err",2);n([l()],s.prototype,"supply",2);n([l()],s.prototype,"updateSupply",2);n([l()],s.prototype,"holders",2);s=n([C("view-home")],s);export{s as ViewHome};
