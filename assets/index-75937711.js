import{T as g,b as y,g as p,s as w}from"./index-b5a0ffc0.js";import{t as $,h as v,A as m,l as b,S as f}from"./utils-7ef6d2ed.js";import{a as S,x as i,h as x,m as h,n as r,t as c,e as k}from"./vendor-aedf1e0d.js";const _="";var j=Object.defineProperty,O=Object.getOwnPropertyDescriptor,n=(t,e,a,o)=>{for(var l=o>1?void 0:o?O(e,a):e,u=t.length-1,d;u>=0;u--)(d=t[u])&&(l=(o?d(e,a,l):d(l))||l);return o&&l&&j(e,a,l),l};let s=class extends g(_){constructor(){super(...arguments),this.bindBridge=new S(this,y),this.creating=!1,this.linking=!0,this.supply=0,this.updateSupply=p("Fans3Shares").then(t=>t.sharesSupply(this.account).then(e=>(this.supply=e,e)).catch(()=>0)),this.holders=p("Fans3Shares").then(t=>t.getFansOfSubject(this.account).then(e=>i`<ul>${x(e,a=>i`<li>${a}(${h($(a),i`<i class="text-sm mdi mdi-loading"></i>`)}): ${h(v(this.account,a),i`<i class="text-sm mdi mdi-loading"></i>`)}</li>`)}</ul>`))}get account(){return y.account}updateTwitter(){return fetch(m+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1})}async link(){for(this.linking=!0;;){try{let t=await fetch(m+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await w(f)}}async create(){this.creating=!0;try{let t=await p("Fans3Shares"),e=await t.getBuyPriceAfterFee(this.account,1);await(await t.buyShares(this.account,1,{value:e})).wait(),this.updateSupply}catch(t){this.err=t}this.creating=!1}render(){return i`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${b}"></div><div class="ui-container">${r(this.err,()=>i`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn></div>${r(this.account&&!this.twitter,()=>(this.updateTwitter(),i`<div class="my-4">Link your twitter to continue<ui-button href="${m}/login?address=${this.account}" @click="${this.link}" class="ml-2 uppercase ${r(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${r(this.linking,()=>i`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))} ${r(this.twitter,()=>i`<div class="my-4">Twitter: ${this.twitter.name}</div>`)} ${r(this.account&&this.twitter,()=>i`<ui-link link href="/x/${this.account}" class="my-2">Link to buy my share</ui-link><div class="my-4"><span class="my-2">${h(this.updateSupply,i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)} holdings</span><br>${r(this.supply,()=>i`${h(this.holders,i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`,()=>i`<ui-button sm class="my-2" ?disabled="${this.creating}" @click="${this.create}">Create${r(this.creating,()=>i`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button>`)}</div>`)}</div></div>`}};n([c()],s.prototype,"twitter",2);n([c()],s.prototype,"creating",2);n([c()],s.prototype,"linking",2);n([c()],s.prototype,"err",2);n([c()],s.prototype,"supply",2);n([c()],s.prototype,"updateSupply",2);n([c()],s.prototype,"holders",2);s=n([k("view-home")],s);export{s as ViewHome};
