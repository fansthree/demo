import{T as $,b,g as d,s as v}from"./index-69b2d980.js";import{t as y,h as S,A as g,C as c,l as f,S as x}from"./utils-5c644dba.js";import{a as H,j as w,x as e,h as P,m as l,n,t as a,e as F}from"./vendor-38c8194b.js";var k=Object.defineProperty,C=Object.getOwnPropertyDescriptor,r=(t,s,h,u)=>{for(var o=u>1?void 0:u?C(s,h):s,p=t.length-1,m;p>=0;p--)(m=t[p])&&(o=(u?m(s,h,o):m(o))||o);return u&&o&&k(s,h,o),o};let i=class extends $({}){constructor(){super(...arguments),this.bindBridge=new H(this,b),this.shareHolder="",this.buying=!1,this.selling=!1,this.linking=!0,this.supply=0,this.updateSupply=d("Fans3Shares",{address:c}).then(t=>t.sharesSupply(this.shareHolder).then(s=>(this.supply=s,s)).catch(()=>0)),this.price=d("Fans3Shares",{address:c}).then(t=>t.getBuyPrice(this.shareHolder,1).then(s=>w(s))),this.buyPrice=d("Fans3Shares",{address:c}).then(t=>t.getBuyPrice(this.shareHolder,1).then(s=>w(s))),this.sellPrice=d("Fans3Shares",{address:c}).then(t=>t.getSellPrice(this.shareHolder,1).then(s=>w(s))),this.holders=d("Fans3Shares",{address:c}).then(t=>t.getFansOfSubject(this.shareHolder).then(s=>e`<ul>${P(s,h=>e`<li>${h}(${l(y(h),e`<i class="text-sm mdi mdi-loading"></i>`)}): ${l(S(this.account,h))}</li>`)}</ul>`))}updateTwitter(){return fetch(g+"/user?address="+this.account).then(t=>t.json()).then(t=>(this.twitter=t,"")).finally(()=>{this.linking=!1})}get account(){return b.account}async link(){for(this.linking=!0;;){try{let t=await fetch(g+"/user?address="+this.account,{mode:"no-cors"});this.twitter=await t.json();return}catch(t){console.log(t)}await v(x)}}async buy(){this.buying=!0;try{let t=await d("Fans3Shares",{address:c}),s=await t.getBuyPriceAfterFee(this.shareHolder,1);await(await t.buyShares(this.shareHolder,1,{value:s})).wait()}catch(t){this.err=t}this.buying=!1}async sell(){this.selling=!0;try{await(await(await d("Fans3Shares",{address:c})).sellShares(this.shareHolder,1)).wait()}catch(t){this.err=t}this.selling=!1}render(){return e`<div class="home"><div class="ui-container my-4"><img class="w-24 object-contain select-none pointer-events-none" src="${f}"></div><div class="ui-container">${n(this.err,()=>e`<span class="text-red-500">${this.err}</span>`)}<div class="my-4">Wallet Address:<connect-wallet-btn></connect-wallet-btn>${n(this.twitter,()=>e`<br>Twitter: ${this.twitter.name}`)}</div><div class="my-4"><span>You are viewing ${this.shareHolder}(${l(y(this.shareHolder),e`<i class="text-sm mdi mdi-loading"></i>`)})'s shares</span><br><span>Holding: ${l(this.updateSupply,e`<i class="text-sm mdi mdi-loading"></i>`)}</span><br><span>Price: ${l(this.price,e`<i class="text-sm mdi mdi-loading"></i>`)}</span></div><div class="my-4 ${n(this.account,()=>"hidden")}">Connect your wallet to buy/sell shares</div>${n(this.account&&!this.twitter,()=>(this.updateTwitter(),e`<div class="my-4">Link your twitter to continue<ui-button href="${g}/login?address=${this.account}" @click="${this.link}" class="ml-2 ${n(this.twitter,()=>"hidden")}" ?disabled="${this.linking}" sm>${n(this.linking,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`,()=>"Link")}</ui-button></div>`))}<div class="my-4">Buy price: ${l(this.buyPrice,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.buying}" @click="${this.buy}">Buy${n(this.buying,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button><br>Sell price: ${l(this.sellPrice,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}<ui-button sm class="m-2" ?disabled="${this.selling}" @click="${this.sell}">Sell${n(this.selling,()=>e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}</ui-button></div><div class="my-4"><span class="my-2">Holdings: of ${this.shareHolder}(${l(y(this.shareHolder),e`<i class="text-sm mdi mdi-loading"></i>`)})</span><br>${n(this.supply,()=>e`${l(this.holders,e`<i class="ml-2 text-sm mdi mdi-loading"></i>`)}`)}</div></div></div>`}};r([a()],i.prototype,"twitter",2);r([a()],i.prototype,"shareHolder",2);r([a()],i.prototype,"buying",2);r([a()],i.prototype,"selling",2);r([a()],i.prototype,"linking",2);r([a()],i.prototype,"err",2);r([a()],i.prototype,"supply",2);r([a()],i.prototype,"updateSupply",2);r([a()],i.prototype,"price",2);r([a()],i.prototype,"buyPrice",2);r([a()],i.prototype,"sellPrice",2);r([a()],i.prototype,"holders",2);i=r([F("view-ex")],i);export{i as ViewEx};
